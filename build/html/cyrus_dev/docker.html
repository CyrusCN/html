<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>1. Tools Learn &mdash; Quantaunit 1.0.0 documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../_static/jquery.js?v=5d32c60e"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../_static/documentation_options.js?v=8d563738"></script>
        <script src="../_static/doctools.js?v=888ff710"></script>
        <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="2. Quanta Devlop and Systems Engineering" href="quanta.html" />
    <link rel="prev" title="Welcome to Quantaunit" href="../index.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            Quantaunit
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">1. Tools Learn</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#docker">1.1. Docker</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#docker-use-example">1.1.1. Docker use Example</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#nginx-web-sphinx-with-ssl">1.1.1.1. NGINX web Sphinx With SSL</a></li>
<li class="toctree-l4"><a class="reference internal" href="#jenkins">1.1.1.2. Jenkins</a></li>
<li class="toctree-l4"><a class="reference internal" href="#nextcloud">1.1.1.3. Nextcloud</a></li>
<li class="toctree-l4"><a class="reference internal" href="#other-local-services-application-packet-by-yourself">1.1.1.4. Other Local Services(Application) Packet by Yourself</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#docker-swarm">1.1.2. Docker swarm</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#kubernetes-k8s">1.2. Kubernetes(k8s)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#kubeadm">1.2.1. kubeadm(集群管理员)</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#kubelet">1.2.1.1. kubelet(集群命令信使)</a></li>
<li class="toctree-l4"><a class="reference internal" href="#kube-dashboard">1.2.1.2. Kube-Dashboard</a></li>
<li class="toctree-l4"><a class="reference internal" href="#elasticsearch-node">1.2.1.3. ElasticSearch Node</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#openstack">1.2.2. Openstack</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="quanta.html">2. Quanta Devlop and Systems Engineering</a></li>
<li class="toctree-l1"><a class="reference internal" href="appendix.html">3. Catalog</a></li>
<li class="toctree-l1"><a class="reference internal" href="about.html">4. About Me</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Quantaunit</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active"><span class="section-number">1. </span>Tools Learn</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/cyrus_dev/docker.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="tools-learn">
<h1><span class="section-number">1. </span>Tools Learn<a class="headerlink" href="#tools-learn" title="Link to this heading"></a></h1>
<section id="docker">
<h2><span class="section-number">1.1. </span>Docker<a class="headerlink" href="#docker" title="Link to this heading"></a></h2>
<p>Docker can be seen a mini-vitural-system, its img like some system.iso and use the img to be a finished application(container) level.</p>
<section id="docker-use-example">
<h3><span class="section-number">1.1.1. </span>Docker use Example<a class="headerlink" href="#docker-use-example" title="Link to this heading"></a></h3>
<p>At the beginning, you should take something into consideration such as the io between local and container.</p>
<p>Some way to set up docker application.</p>
<ol class="arabic simple">
<li><p>docker composer(apt install/yum)</p></li>
</ol>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;3&#39;</span>
<span class="c1">#volumes:</span>
<span class="c1">#easy to remember:</span>
<span class="nt">services</span><span class="p">:</span>
<span class="w">  </span><span class="nt">app</span><span class="p">:</span>
<span class="w">    </span><span class="nt">container_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">name</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">image name</span>
<span class="w">    </span><span class="nt">restart</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">always</span>
<span class="w">  </span><span class="nt">ports</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8080:8080</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1935:1935</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1985:1985</span>
<span class="w">  </span><span class="nt">networks</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">networkname</span>
<span class="w">  </span><span class="nt">deploy</span><span class="p">:</span>
<span class="w">    </span><span class="nt">resources</span><span class="p">:</span>
<span class="w">      </span><span class="nt">limits</span><span class="p">:</span>
<span class="w">        </span><span class="nt">cpus</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;0.5&quot;</span>
<span class="w">        </span><span class="nt">memory</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">500M</span>
<span class="w">      </span><span class="nt">reservations</span><span class="p">:</span>
<span class="w">        </span><span class="nt">memory</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">200M</span>

<span class="nt">networks</span><span class="p">:</span>
<span class="w">  </span><span class="nt">networkname</span><span class="p">:</span>
<span class="w">    </span><span class="nt">driver</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bridge</span>
</pre></div>
</div>
<ol class="arabic simple" start="2">
<li><p>Makefile</p></li>
</ol>
<p>Create a Makefile in (~/dockerauto) and easy to excute command →make run</p>
<div class="highlight-Makefile notranslate"><div class="highlight"><pre><span></span><span class="nv">ImgName</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span>nginx
<span class="nv">LocalLoc</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span>~/html/build/html
<span class="nv">port</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="m">80</span>
<span class="nv">ssl</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="m">443</span>
<span class="nv">ContainerLoc</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span>/usr/share/nginx/html
<span class="nv">ngst</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span>/etc/nginx
<span class="nv">ngstlc</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span>~/dockerauto/conf
<span class="nf">build</span><span class="o">:</span>
<span class="w">      </span>docker<span class="w"> </span>build<span class="w"> </span>-t<span class="w"> </span><span class="k">$(</span>ImgName<span class="k">)</span><span class="w"> </span>.
<span class="nf">run</span><span class="o">:</span>
<span class="w">      </span>docker<span class="w"> </span>run<span class="w"> </span>-it<span class="w"> </span>-d<span class="w"> </span>-v<span class="w"> </span><span class="k">$(</span>ngstlc<span class="k">)</span>:<span class="k">$(</span>ngst<span class="k">)</span><span class="w"> </span>-p<span class="w"> </span><span class="k">$(</span>port<span class="k">)</span>:<span class="k">$(</span>port<span class="k">)</span><span class="w"> </span>-p<span class="w"> </span><span class="k">$(</span>ssl<span class="k">)</span>:<span class="k">$(</span>ssl<span class="k">)</span><span class="w"> </span>-v<span class="w"> </span><span class="k">$(</span>LocalLoc<span class="k">)</span>:<span class="k">$(</span>ContainerLoc<span class="k">)</span><span class="w"> </span><span class="k">$(</span>ImgName<span class="k">)</span>
<span class="nf">status</span><span class="o">:</span>
<span class="w">      </span>docker<span class="w"> </span>ps<span class="w"> </span>-a
<span class="nf">stop</span><span class="o">:</span>
<span class="w">      </span>docker<span class="w"> </span>stop<span class="w"> </span>container<span class="w"> </span><span class="k">$(</span>ImgName<span class="k">)</span>
<span class="nf">shell</span><span class="o">:</span>
<span class="w">      </span>docker<span class="w"> </span>run<span class="w"> </span>-it<span class="w"> </span><span class="k">$(</span>ImgName<span class="k">)</span><span class="w"> </span>/bin/bash
<span class="nf">rm</span><span class="o">:</span>
<span class="w">      </span>docker<span class="w"> </span>rm<span class="w"> </span><span class="k">$(</span>ImgName<span class="k">)</span>
</pre></div>
</div>
<ol class="arabic simple" start="3">
<li><p>Bash command(Just convert the $)</p></li>
</ol>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>docker<span class="w"> </span>run<span class="w"> </span>-it<span class="w"> </span>-d<span class="w"> </span>-v<span class="w"> </span><span class="k">$(</span>ngstlc<span class="k">)</span>:<span class="k">$(</span>ngst<span class="k">)</span><span class="w"> </span>-p<span class="w"> </span><span class="k">$(</span>port<span class="k">)</span>:<span class="k">$(</span>port<span class="k">)</span><span class="w"> </span>-p<span class="w"> </span><span class="k">$(</span>ssl<span class="k">)</span>:<span class="k">$(</span>ssl<span class="k">)</span><span class="w"> </span>-v<span class="w"> </span><span class="k">$(</span>LocalLoc<span class="k">)</span>:<span class="k">$(</span>ContainerLoc<span class="k">)</span><span class="w"> </span><span class="k">$(</span>ImgName<span class="k">)</span>
</pre></div>
</div>
<section id="nginx-web-sphinx-with-ssl">
<span id="my-reference-label"></span><h4><span class="section-number">1.1.1.1. </span>NGINX web Sphinx With SSL<a class="headerlink" href="#nginx-web-sphinx-with-ssl" title="Link to this heading"></a></h4>
<p>NGINX is a tool listen your local services and make your services can be seen at some port and transmit your data as the http or secure https, so when you change the nginx config, there are some ssl(Secure Sockets Layer,Public and Private Key) conf no metter who supply, neither offcial or yourself.
Here are some step.</p>
<ol class="arabic simple">
<li><p>From the Makefile to make run a nginx docker container</p></li>
</ol>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ubuntu@VM-0-17-ubuntu:~/dockerauto$<span class="w"> </span><span class="nb">cd</span><span class="w"> </span>~/dockerauto
ubuntu@VM-0-17-ubuntu:~/dockerauto$<span class="w"> </span>make<span class="w"> </span>run
docker<span class="w"> </span>run<span class="w"> </span>-it<span class="w"> </span>-d<span class="w"> </span>-v<span class="w"> </span>~/dockerauto/conf:/etc/nginx<span class="w"> </span>-p<span class="w"> </span><span class="m">80</span>:80<span class="w"> </span>-p<span class="w"> </span><span class="m">443</span>:443<span class="w"> </span>-v<span class="w"> </span>~/html/build/html:/usr/share/nginx/html<span class="w"> </span>nginx
6e6b2c4fbcc53c606e4aa19dd993e397991ff7975554df667d7cd0f895157313
</pre></div>
</div>
<ol class="arabic simple" start="2">
<li><p>Change the nginx config file(in local path but Mapping in docker container)</p></li>
</ol>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ubuntu@VM-0-17-ubuntu:~/dockerauto$<span class="w"> </span><span class="nb">cd</span><span class="w"> </span>~/dockerauto/conf/conf.d$
ubuntu@VM-0-17-ubuntu:~/dockerauto/conf$<span class="w"> </span>nano<span class="w"> </span>default.conf
</pre></div>
</div>
<ol class="arabic simple" start="3">
<li><p>Port 80 to 443 and Put crt path</p></li>
</ol>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">server {</span>
<span class="w">    </span><span class="l l-Scalar l-Scalar-Plain">listen 80;</span>
<span class="w">    </span><span class="l l-Scalar l-Scalar-Plain">server_name lovesyu.cn www.lovesyu.cn;</span>
<span class="w">    </span><span class="l l-Scalar l-Scalar-Plain"># 301 永久重定向到 HTTPS</span>
<span class="w">    </span><span class="l l-Scalar l-Scalar-Plain">return 301 https://$host$request_uri;</span>
<span class="l l-Scalar l-Scalar-Plain">}</span>
<span class="l l-Scalar l-Scalar-Plain">server {</span>
<span class="w">    </span><span class="l l-Scalar l-Scalar-Plain">listen       443 ssl;</span>
<span class="w">      </span><span class="l l-Scalar l-Scalar-Plain">server_name  lovesyu.cn www.lovesyu.cn;</span>
<span class="w">    </span><span class="l l-Scalar l-Scalar-Plain">http2 on;</span>
<span class="w">      </span><span class="l l-Scalar l-Scalar-Plain">ssl_certificate /etc/nginx/lovesyu.cn_bundle.crt;</span>
<span class="w">      </span><span class="l l-Scalar l-Scalar-Plain">ssl_certificate_key /etc/nginx/lovesyu.cn.key;</span>

<span class="w">      </span><span class="l l-Scalar l-Scalar-Plain">ssl_protocols TLSv1 TLSv1.1 TLSv1.2;</span><span class="w"> </span><span class="c1">#允许的协议</span>
<span class="w">      </span><span class="l l-Scalar l-Scalar-Plain">ssl_ciphers &#39;TLS_AES_128_GCM_SHA256:TLS_AES_256_GCM_SHA384:TLS_CHACHA20_POLY1305_SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-RSA-AES256-GCM-SHA384&#39;;</span>
</pre></div>
</div>
<ol class="arabic simple" start="4">
<li><p>Put your crt and key document in your local path</p></li>
</ol>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ubuntu@VM-0-17-ubuntu:~/dockerauto/conf/conf.d$<span class="w"> </span><span class="nb">cd</span><span class="w"> </span>..
ubuntu@VM-0-17-ubuntu:~/dockerauto/conf$
scp<span class="w"> </span>your<span class="w"> </span>crt<span class="w"> </span>and<span class="w"> </span>key<span class="w"> </span>from<span class="w"> </span>Powershell<span class="o">(</span>or<span class="w"> </span>other<span class="w"> </span>sysyem<span class="w"> </span>openssh<span class="o">)</span>
<span class="nb">exit</span>
PS<span class="w"> </span>C:<span class="se">\U</span>sers<span class="se">\5</span>21cy&gt;<span class="w"> </span>scp<span class="w"> </span><span class="s2">&quot;C:\Users\521cy\Desktop\yourkey.key&quot;</span><span class="w"> </span>ubuntu@lovesyu.cn:/home/ubuntu/dockerauto/conf/yourkey.key
PS<span class="w"> </span>C:<span class="se">\U</span>sers<span class="se">\5</span>21cy&gt;<span class="w"> </span>scp<span class="w"> </span><span class="s2">&quot;C:\Users\521cy\Desktop\yourcrt.crt&quot;</span><span class="w"> </span>ubuntu@lovesyu.cn:/home/ubuntu/dockerauto/conf/yourcrt.crt
</pre></div>
</div>
<ol class="arabic simple" start="5">
<li><p>Install Sphinx Application</p></li>
</ol>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>python3-pip
<span class="nb">cd</span><span class="w"> </span>html
pip3<span class="w"> </span>install<span class="w"> </span>Sphinx
sphinx-quickstart
<span class="c1"># it will create build and Makefile in your ~/html,</span>
make<span class="w"> </span>html
<span class="c1"># it will build your html in your ~/html/build/html (you can check your nginx config true or false)</span>
other<span class="w"> </span>document<span class="w"> </span>goto<span class="w"> </span>sphinx<span class="w"> </span>website<span class="w"> </span>to<span class="w"> </span>learn.
</pre></div>
</div>
<p><a class="reference external" href="https://www.sphinx-doc.org/">https://www.sphinx-doc.org/</a></p>
</section>
<section id="jenkins">
<h4><span class="section-number">1.1.1.2. </span>Jenkins<a class="headerlink" href="#jenkins" title="Link to this heading"></a></h4>
<ol class="arabic simple">
<li><p>From the docker-composer to run a Jenkins container</p></li>
</ol>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;3&#39;</span>

<span class="nt">services</span><span class="p">:</span>
<span class="w"> </span><span class="nt">jenkins</span><span class="p">:</span>
<span class="w">    </span><span class="nt">container_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">aio-add</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">jenkins/jenkins:lts-jdk11</span>
<span class="w">    </span><span class="nt">restart</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">always</span>
<span class="w">    </span><span class="nt">ports</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8008:8080</span>
<span class="w">    </span><span class="nt">volumes</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/root/066/sql/Cyrus/files/devjenkins/jenkins:/var/jenkins_home</span>
<span class="w">    </span><span class="nt">deploy</span><span class="p">:</span>
<span class="w">    </span><span class="nt">resources</span><span class="p">:</span>
<span class="w">       </span><span class="nt">limits</span><span class="p">:</span>
<span class="w">          </span><span class="nt">cpus</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;0.15&quot;</span>
<span class="w">          </span><span class="nt">memory</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8G</span>
<span class="w">       </span><span class="nt">reservations</span><span class="p">:</span>
<span class="w">          </span><span class="nt">memory</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">200M</span>
</pre></div>
</div>
</section>
<section id="nextcloud">
<h4><span class="section-number">1.1.1.3. </span>Nextcloud<a class="headerlink" href="#nextcloud" title="Link to this heading"></a></h4>
<ol class="arabic simple">
<li><p>From bash docker command to run</p></li>
</ol>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>docker<span class="w"> </span>run<span class="w"> </span>-it<span class="w"> </span>-d<span class="w"> </span>-v<span class="w"> </span>/root/066/nextcloudapp:/var/www/html<span class="w"> </span>-v<span class="w"> </span>/root/066/sql:/var/www/html/data<span class="w"> </span>-p<span class="w"> </span><span class="m">80</span>:80<span class="w"> </span>-p<span class="w"> </span><span class="m">443</span>:443<span class="w">  </span>nextcloud
</pre></div>
</div>
<ol class="arabic simple" start="2">
<li><p>SSL</p></li>
</ol>
<p>Add your Path to -v and Change Nginx config <a class="reference internal" href="#my-reference-label"><span class="std std-ref">NGINX web Sphinx With SSL</span></a></p>
</section>
<section id="other-local-services-application-packet-by-yourself">
<h4><span class="section-number">1.1.1.4. </span>Other Local Services(Application) Packet by Yourself<a class="headerlink" href="#other-local-services-application-packet-by-yourself" title="Link to this heading"></a></h4>
<ol class="arabic simple">
<li><p>Pull a minimal image（For your favorite system）(docker pull image)</p></li>
<li><p>Create container for image</p></li>
<li><p>Into container</p></li>
</ol>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>docker<span class="w"> </span>run<span class="w"> </span>-it<span class="w"> </span><span class="k">$(</span>ImgName<span class="k">)</span><span class="w"> </span>/bin/bash
</pre></div>
</div>
<ol class="arabic simple" start="4">
<li><p>Add your application</p></li>
<li><p>Exit container</p></li>
<li><p>Packet</p></li>
</ol>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>docker<span class="w"> </span>commit<span class="w"> </span><span class="o">[</span>OPTIONS<span class="o">]</span><span class="w"> </span>CONTAINER<span class="w"> </span><span class="o">[</span>REPOSITORY<span class="o">[</span>:TAG<span class="o">]]</span>
</pre></div>
</div>
</section>
</section>
<section id="docker-swarm">
<h3><span class="section-number">1.1.2. </span>Docker swarm<a class="headerlink" href="#docker-swarm" title="Link to this heading"></a></h3>
<p>建议使用k8s更为轻量，node以容器形式存在过于损耗性能，臃肿。</p>
<p>如只想使用docker集群,建议搭配Portainer使用,节点主管理和节点请看</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>docker<span class="w"> </span>swarm
</pre></div>
</div>
</section>
</section>
<section id="kubernetes-k8s">
<h2><span class="section-number">1.2. </span>Kubernetes(k8s)<a class="headerlink" href="#kubernetes-k8s" title="Link to this heading"></a></h2>
<div class="toctree-wrapper compound">
</div>
<p><a class="reference external" href="https://phyng.com/2023/04/09/pve-kubernetes.html">https://phyng.com/2023/04/09/pve-kubernetes.html</a>
该博主提供了早期版本且网络环境为直通外网，PVE7.4-3 k8s1.26.3
本文基于PVE8.0.9 ，k8s1.28.4,无外网环境拉取镜像</p>
<p>强烈建议根据官网版本学习，添加K8S源，安装K8S套件。本文根据2023/10/25官网版本1.28所述所撰</p>
<p><a class="reference external" href="https://kubernetes.io/zh-cn/docs/setup/production-environment/tools/kubeadm/install-kubeadm/">https://kubernetes.io/zh-cn/docs/setup/production-environment/tools/kubeadm/install-kubeadm/</a></p>
<p>以下指令适用于 Kubernetes 1.28.</p>
<p>更新 apt 包索引并安装使用 Kubernetes apt 仓库所需要的包：</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo<span class="w"> </span>apt-get<span class="w"> </span>update
sudo<span class="w"> </span>apt-get<span class="w"> </span>install<span class="w"> </span>-y<span class="w"> </span>apt-transport-https<span class="w"> </span>ca-certificates<span class="w"> </span>curl<span class="w"> </span>gpg
curl<span class="w"> </span>-fsSL<span class="w"> </span>https://pkgs.k8s.io/core:/stable:/v1.28/deb/Release.key<span class="w"> </span><span class="p">|</span><span class="w"> </span>sudo<span class="w"> </span>gpg<span class="w"> </span>--dearmor<span class="w"> </span>-o<span class="w"> </span>/etc/apt/keyrings/kubernetes-apt-keyring.gpg
</pre></div>
</div>
<p>添加 Kubernetes apt 仓库。 请注意，此仓库仅包含适用于 Kubernetes 1.28 的软件包； 对于其他 Kubernetes 次要版本，则需要更改 URL 中的 Kubernetes 次要版本以匹配你所需的次要版本 （你还应该检查正在阅读的安装文档是否为你计划安装的 Kubernetes 版本的文档）。</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">echo</span><span class="w"> </span><span class="s1">&#39;deb [signed-by=/etc/apt/keyrings/kubernetes-apt-keyring.gpg] https://pkgs.k8s.io/core:/stable:/v1.28/deb/ /&#39;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>sudo<span class="w"> </span>tee<span class="w"> </span>/etc/apt/sources.list.d/kubernetes.list
</pre></div>
</div>
<p>更新 apt 包索引，安装 kubelet、kubeadm 和 kubectl，并锁定其版本：</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo<span class="w"> </span>apt-get<span class="w"> </span>update
sudo<span class="w"> </span>apt-get<span class="w"> </span>install<span class="w"> </span>-y<span class="w"> </span>kubelet<span class="w"> </span>kubeadm<span class="w"> </span>kubectl
sudo<span class="w"> </span>apt-mark<span class="w"> </span>hold<span class="w"> </span>kubelet<span class="w"> </span>kubeadm<span class="w"> </span>kubectl
</pre></div>
</div>
<p>在 Debian 12 和 Ubuntu 22.04 之前的早期版本中，默认情况下不存在 /etc/apt/keyrings 目录； 你可以通过运行</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo<span class="w"> </span>mkdir<span class="w"> </span>-m<span class="w"> </span><span class="m">755</span><span class="w"> </span>/etc/apt/keyrings
</pre></div>
</div>
<p>kubelet 现在每隔几秒就会重启，因为它陷入了一个等待 kubeadm 指令的死循环。</p>
<p>以下k8s应用过程基于自己总结，具体架构图请根据官网架构自行安排。</p>
<section id="kubeadm">
<h3><span class="section-number">1.2.1. </span>kubeadm(集群管理员)<a class="headerlink" href="#kubeadm" title="Link to this heading"></a></h3>
<p>该工具是控制中心，分发给信使kubelet,操作kubectl部署集群。
需要对接下级kubelet配置文件，中心服务器（控制中心）安装。</p>
<section id="kubelet">
<h4><span class="section-number">1.2.1.1. </span>kubelet(集群命令信使)<a class="headerlink" href="#kubelet" title="Link to this heading"></a></h4>
<p>需给上级kubeadm提供Node状态信息，节点服务器安装。 由cgroupfs控制（cgroup调度）
该工具类似于集群节点proxy,使adm命令能通过let代理控制ctl。</p>
<section id="kubectl">
<h5><span class="section-number">1.2.1.1.1. </span>kubectl(控制台工具)<a class="headerlink" href="#kubectl" title="Link to this heading"></a></h5>
<p>该工具是分发控制命令的工具，接受来自kubelet的传递命令，分发给下级Cgroupfs/systemd/Cgroup进行调度，所有机器都装。</p>
<section id="kube-cgroup">
<h6><span class="section-number">1.2.1.1.1.1. </span>kube-cgroup(与物理机资源有关)<a class="headerlink" href="#kube-cgroup" title="Link to this heading"></a></h6>
<p>以下为个人理解，非专业出身，具体请看Linux的内核和调度。</p>
<p>根据Linux的调度方式，取不同的调度方式</p>
<p>1. 早期的Linux纯init调度，单一进程
init进程是串行启动，只有前一个进程启动完，才会启动下一个进程。
启动脚本复杂。init进程只是执行启动脚本，不管其他事情。脚本需要自己处理各种情况，这往往使得脚本变得很长。</p>
<p>在命令行中由</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>service<span class="w"> </span>...<span class="w"> </span>start
/etc/init.d/...<span class="w"> </span>start
</pre></div>
</div>
<ol class="arabic simple" start="2">
<li><p>systemd 主进程，其余为子进程(此时产生了cgroup这个东西，控制子进程init)</p></li>
</ol>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>systemctl<span class="w"> </span>status
systemctl<span class="w"> </span>start
</pre></div>
</div>
<p>因为kubelet 自带cgroupfs,控制cgroup
但systemd也控制着cgroup,容易产生冲突，
官方的意思大概是，把kubelet的调度默认成cgroup,不由fs控制。避免多个cgroup抢占资源</p>
<ol class="arabic simple" start="3">
<li><p>cgroupfs2(这个是如今Linux的调度模式，具体没做了解)</p></li>
</ol>
<p>调度有关，具体看官网</p>
<section id="kubeapplication-podcontainerd-dockerdimages">
<h6 aria-level="7"><span class="section-number">1.2.1.1.1.1.1. </span>kubeapplication(Pod→Containerd/Dockerd→Images)<a class="headerlink" href="#kubeapplication-podcontainerd-dockerdimages" title="Link to this heading"></a></h6>
<p>Pod是应用单元，需要Runtime官方称作容器运行时，的以下几种方式作为进程</p>
<ol class="arabic simple">
<li><p>Containerd进程命令行中由crictl控制（最初的容器）</p></li>
<li><p>CRI-O（与Contained不同的调度方式，cgroup不同）升级版containerd</p></li>
<li><p>Dockershim(k8s 在1.24之前自带minidockerd,1.24后被移除)</p></li>
<li><p>CRI-Dockerd(docker与k8s相互作用的服务端)(分离后版本，于1.24后自主安装)</p></li>
</ol>
<p>images:可以由docker pull 拉，也可以用cri pull拉，镜像大体通用，需要重新命名和读取。</p>
<p>registry.cn-hangzhou.aliyuncs.com/google_containers/kube-scheduler:v1.28.4 → registry.k8s.io/kube-scheduler:v1.28.4</p>
</section>
</section>
</section>
</section>
<section id="kube-dashboard">
<h4><span class="section-number">1.2.1.2. </span>Kube-Dashboard<a class="headerlink" href="#kube-dashboard" title="Link to this heading"></a></h4>
</section>
<section id="elasticsearch-node">
<h4><span class="section-number">1.2.1.3. </span>ElasticSearch Node<a class="headerlink" href="#elasticsearch-node" title="Link to this heading"></a></h4>
</section>
</section>
<section id="openstack">
<h3><span class="section-number">1.2.2. </span>Openstack<a class="headerlink" href="#openstack" title="Link to this heading"></a></h3>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../index.html" class="btn btn-neutral float-left" title="Welcome to Quantaunit" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="quanta.html" class="btn btn-neutral float-right" title="2. Quanta Devlop and Systems Engineering" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, Cyrus.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
  
    <div role="contentinfo" style="margin:auto;">
        <a href="https://beian.miit.gov.cn">辽ICP备2021006634号-1</a>
    </div>


</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>